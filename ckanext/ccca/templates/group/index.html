{% ckan_extends %}

{% block primary %}
  <div class="primary col-md-12">
  {% block primary_content %}
    <article class="module">
      <div class="module-content">
        {% if self.page_primary_action() | trim %}
          <div class="page_primary_action">
            {% block page_primary_action %}
              {% if h.check_access('group_create') %}
                {% link_for _('Add Group'), controller='group', action='new', class_='btn btn-success pull-right', icon='plus-sign-alt' %}
              {% endif %}
            {% endblock %}
          </div>
        {% endif %}

{% block primary_content_inner %}
  <h1 class="hide-heading">{{ _('Groups') }}</h1>
  {% snippet "organization/snippets/helper.html" %}
  {% block groups_search_form %}
    {% snippet 'snippets/search_form.html', form_id='group-search-form', type='group', query=c.q, sorting_selected=c.sort_by_selected, count=c.page.item_count, placeholder=_('Search groups...'), show_empty=request.params, no_bottom_border=true if c.page.items, sorting = 'False', no_title='small' %}
  {% endblock %}
  {% block groups_list %}
    {% set type_of_groups = [] %}
    {%- set schema = h.scheming_get_group_schema('group') -%}
    {% set field = h.scheming_field_by_name(schema['fields'], 'type_of_group') %}
    {% for choice in field['choices'] %}
      {% do type_of_groups.append(choice) %}
    {% endfor %}



  <div id="accordion" role="tablist">
    {% for group_type in type_of_groups %}
  <div class="card">
    <div class="card-header" role="tab" id="headingOne">
      <div class="row">
      <h3 class="mb-0">
       <div class="col-sm-2 col-xs-2">
        <a data-toggle="collapse" href="#collapse{{ loop.index }}" aria-expanded="true" aria-controls="collapse{{ loop.index }}">
          {{ group_type['label'] }}
        </a>
       </div>
       <div class="col-sm-1 col-xs-2">
        <a data-toggle="collapse" href="#collapse{{ loop.index }}" aria-expanded="true" aria-controls="collapse{{ loop.index }}">
            <i class="icon-angle-down"></i>
        </a>
       </div>
      </h3>
      </div>
    </div>

    <div id="collapse{{ loop.index }}" class="collapse" role="tabpanel" aria-labelledby="heading{{ loop.index }}" data-parent="#accordion">
      <div class="card-body">
            {% set groups_of_correct_type = [] %}
              {% for item in c.page.items %}
                {% set group = h.ccca_group_show(item.id) %}
                {% if group['type_of_group'] == group_type['value'] %}
                    {% do groups_of_correct_type.append(item) %}
                {% endif %}
              {% endfor %}

            {% if groups_of_correct_type|length > 0 or request.params %}
              {% if groups_of_correct_type|length > 0 %}
              <ul class="media">
                {% for group in groups_of_correct_type %}
                  {% snippet "group/snippets/group_item.html", group=group, position=loop.index %}
                {% endfor %}
              </ul>
              {% endif %}
            {% else %}
              <p class="empty">
                {{ _('There are currently no groups of type "' + group_type['label'] + '"') }}.
                {% if h.check_access('group_create') %}
                  {% link_for _('How about creating one?'), controller='group', action='new' %}</a>.
                {% endif %}
              </p>
            {% endif %}
      </div>
    </div>
  </div>
    {% endfor %}
  </div>
{% endblock %}
  {% endblock %}


      </div>
    </article>
  {% endblock %}
  </div>
{% endblock %}

{% block secondary %}
{% endblock %}
